# Uniswap V3 - How to Calculate Price of ETH from sqrtPriceX96_ _ DeFi [hKhdQl126Ys] - Transcript

I'm looking at a Uniswap v3 contract for ETH USDC pool. From the contract, the price of ETH can be calculated by looking at this variable called square root price x 96. So in this video, I'll explain how to calculate the price of ETH from that variable square root price x 96. Here's the formula for how to calculate the price of ETH in terms of USDC. It is equal to 1 over p times 10 to the 12, where p is equal to the square of square root price x 96 divided by q 96, where q 96 is equal to 2 to the 96. This is the formula that you can use to calculate the price of ETH in the ETH USDC pool. But if you notice here, there is a multiplication by 10 to the 12. So where does this 10 to the 12 come from? Most of this video will focus on where this 10 to the 12 comes from. For this video, we're going to be using the USDC WEF pool, and this is the address of the contract deployed on the main net. And at the time when I made this note, the price of ETH is 1296 USDC per ETH, which I got from CoinGecko. Okay, let's begin. First of all, what is p? We'll say that x is equal to token 0 and y is equal to token 1. These are the two tokens in the Uniswap B3 pools. And then we'll say p, the p that you see over here, is equal to price of x in terms of y. In Uniswap B2, you take the amount of tokens and you divide those amounts, and you get the price. However, this no longer works in Uniswap B3. In Uniswap B3, you can get the price, and from the price, you can derive the amount of tokens that are locked in the contract. Let's take a look at an example. We'll say that x is USDC and y is equal to WEF. And then we'll say p is equal to the price of USDC in terms of ETH. p is equal to y divided by x, and let's say that this is equal to 1 ETH is equal to 1296 USDC. Since ETH has 10 decimals and USDC has 6 decimals, this will be equal to 1 times 10 to the 18. ETH has 18 decimals, so 1 ETH is equal to 10 to the 18. And 1296 times 10 to the 6, since USDC has 6 decimals, and 1 USDC is equal to 10 to the 6. We can cancel out the powers of 10, and we are left with 1 divided by 1296 times 10 to the 12. Using a calculator, this is roughly equal to 0.00077 times 10 to the 12. Okay, so we calculated that p is equal to 0.00077 times 10 to the 12. But what does this number mean? How do we interpret this number? Well, what this number is saying is that 1 unit of USDC is equal to 0.00077 times 10 to the 12 units of ETH. 1 unit of USDC is equal to 1 over 10 to the 6. So 1 over 10 to the 6 USDC is equal to 0.00077 times 10 to the 12, and 1 unit of ETH is 1 over 10 to the 18. And we can simplify this part, and this part will be equal to this decimal number times, we have a 10 to the 12, and then we divide it by 10 to the 18. So what we're left with is 10 to the minus 6. Now notice that I have over here 1 over 10 to the 6. This is equal to 10 to the minus 6, and we also have a 10 to the minus 6 over here, and we can cancel these two out. And we can now say that 1 USDC is equal to 0.00077 ETH. p equals 0.00077 times 10 to the 12. This number means that 1 USDC is equal to 0.00077 ETH. If you wanted to buy 1 USDC and you had only ETH, then this is the amount of ETH that you'll need to pay. So this is the price of USDC in terms of ETH, but what we're interested in is the price of ETH in terms of USDC. So what we'll need to do is flip p to 1 over p. Let's take a look at an example. Let's go over an example of price of ETH in terms of USDC. Price of USDC in terms of ETH is equal to p, so to get the price of ETH in terms of USDC, we'll need to flip p and we get 1 over p. p is equal to y divided by x, so 1 over p is equal to x divided by y. Let's use the same number as the example above and say 1,296 USDC is equal to 1 ETH. Again, 1 USDC is equal to 10 to the 6, so we multiply 1,296 by 10 to the 6, and 1 ETH is equal to 10 to the 18, so we multiply 1 by 10 to the 18. We can simplify the powers of 10 and we get 1,296 times 10 to the minus 12. 1 over p is equal to 1,296 times 10 to the 12. Again, let's answer the question what this number means. This number is telling us that 1 unit of ETH is equal to 1,296 times 10 to the 12 units of USDC. 1 unit of ETH is equal to 1 over 10 to the 18. This is equal to 1,296 times 10 to the minus 12 units of USDC. 1 unit of USDC is equal to 1 over 10 to the 6. We can simplify this part of the equation and we get 1,296 times 10 to the minus 12 multiplied by 10 to the minus 6. That will be 10 to the minus 18. So this will be 10 to the minus 18. Now again, I see a 10 to the minus 18 over here and a 10 to the minus 18 over here, and these two can cancel out. So what we're left with is that 1 ETH, 1 ETH is equal to 1,296 USDC. So let's say that the price of ETH is 1,296 USDC and we calculate 1 over p to be equal to 1,296 times 10 to the 12. What this will mean is that 1 ETH is equal to 1,296 USDC. But how do we calculate the price of ETH starting from square root price X96? This is the variable related to the price of tokens stored in Uniswap B3 contract. What is square root price X96? Square root price X96 is equal to the square root of p times Q96, where Q96 is equal to 2 to the 96. So to get p, you would divide square root price X96 by Q96, and then to remove this square root, you would square the term on the left. And you get that p is equal to the square of square root price X96 divided by Q96. Let's use this equation to calculate the price of ETH. Let's find the price of ETH from square root price X96. p is equal to the price of USDC in terms of ETH, so to get the price of ETH in terms of USDC, we'll need to compute 1 over p. Price of ETH is equal to 1 over p, and from this equation above, 1 over p is equal to 1 over this part of this equation. I'll copy it and paste it here. Square of square root of price X96 divided by Q96. Okay, so let's go over an example of this. When I made this note, square root price X96 is equal to this big number, and to get the latest square root price X96, you can go over to the Uniswap B3 pool contract, and then on the slot 0, find the variable called square root price X96. Let's first find p by computing the right term of the equation. So this will be equal to square root price X96 is this big number divided by Q96, and Q96 is equal to 2 to the 96, and then we'll need to square this term, and we square this term, and that is equal to p. Using a calculator, this turns out to be p is equal to this number in green. Okay, so once we know p, we can also compute 1 over p. 1 over p is equal to 1 over this number, so I'll put it here, and using my calculator, this turns out to be 1.296 times 10 to the 9. Now recall that from the example above, remember that we said that 1 over p means that 1 unit of ETH will cost 1,296 times 10 to the 12 units of USDC. So going back down, 1 over p, this is the price of 1 unit of ETH, and 1 unit of ETH is 1 over 10 to the 18. So to get the price of 1 ETH, we'll need to multiply this number by 10 to the 18. Price of 1 ETH is equal to price of 1 unit of ETH, which is equal to 1 over 10 to the 18, times, we're going to be buying 10 to the 18 units of ETH. This price is in units of USDC, so we'll need to divide by 1 USDC, and this is equal to 1.296 times 10 to the 9 that you see over here, times 10 to the 18, that is the amount of ETH that we're buying, divided by 10 to the 6, since 10 to the 6 is equal to 1 USDC, and this is equal to, we have a 10 to the 18 up at top, and we have a 10 to the minus 9, and minus 6, so that is minus 15, so we're left with 1.296, 18 minus 15 is equal to 3, so we're left with 1.296 times 10 to the 3, which is equal to 1,296. So this means that the price of 1 ETH is equal to 1,296 USDC per ETH. Now notice that this part in green is equal to 1 over P, and this ratio of 10 to the 18 over 10 to the 6 is equal to 10 to the 12. So in this video, I showed you how to get the price of ETH from square root price x 96, and I also showed you that the price of ETH in terms of USDC is equal to 1 over P times 10 to the 12. This 10 to the 12 counts from the difference of the two tokens. ETH has 18 decimals, and USDC has 6 decimals. 18 minus 6 is equal to 12.