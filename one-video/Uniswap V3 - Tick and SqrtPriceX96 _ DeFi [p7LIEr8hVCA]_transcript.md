# Uniswap V3 - Tick and SqrtPriceX96 _ DeFi [p7LIEr8hVCA] - Transcript

Today, we'll go over how to convert from TIC to sqrtPrice x96 and from sqrtPrice x96 back to TIC. First, let's start off by reviewing some of the variables. We'll say that p is the price of token 0 in terms of token 1. The sqrtPrice x96 is defined to be the sqrt of p times q96 where q96 is equal to 2 to the 96. The TIC is defined to be a number where 1.0001 raised to the TIC is equal to the price p. If we take the sqrtP, then this is equal to the sqrt of 1.0001 to the TIC. It doesn't matter if we raise 1.0001 to the TIC and then take the sqrt, or if we take the sqrt of 1.0001 and then raise it to the TIC. These two give us back the same numbers. From this equation, to get the TIC, we'll need to take the log of base sqrt of 1.0001 of the sqrt of p. Let me show you what I mean by here. So the sqrt of p is equal to this expression. And then to get the TIC back, we'll need to take the log on both sides. So we'll take the log of sqrt of p and the base of the log will be the sqrt of 1.0001. To make it clear that this log is the base of the sqrt of 1.0001, I'll put it here. Then make it a little bit smaller. And then I'll wrap parentheses around the sqrt of p. So if we take the log of base sqrt of 1.0001 of the sqrt of p, and we do the same on this side, then we get the TIC back. The last equation is the equation that we're going to need to calculate from TIC to sqrt x96 and from sqrt x96 back to TIC. So let me show you some equations. Let's start off by coming up with an equation from TIC to sqrt x96. Our starting point will be this equation. So given that we know the number of the TIC, then what we're trying to find is sqrt x96 And this is equal to this equation over here. I'll copy it and then paste it here. And that is the number that we're trying to find. We also know that the sqrt of p is equal to the sqrt of 1.0001 raised to the TIC. And we're assuming here that we already know the number for the TIC. So I'll copy this equation and then also paste it here. And then, since we know the TIC, this will be our starting point. This will be equal to, this will be equal to the sqrt of p. To get the sqrt of price x96, we'll need to multiply the sqrt of p by q96. So I'll copy this and then paste it here. Since we're multiplying this side of the equation by q96, I'll have to do the same on this side of the equation. Paste q96 over here as well. And now notice that the sqrt of 1.0001 raised to the TIC times q96 is equal to the sqrt of p times q96. And we know that this is equal to this equation. So this equation is equal to the sqrt of price x96. So I'll move the sqrt of price x96 over to the left, over to the right. And that is our final equation for calculating. Given that we know the TIC, we can calculate the sqrt of price x96 by following this equation. We can also calculate the other way. If we know the sqrt of price x96, then we can calculate the TIC. So again, let's start with sqrt of price x96. We know that sqrt of price x96 is equal to this equation. So I'll copy it and paste it here. And what equation are we going to use to calculate the TIC? Well, we said that the TIC is equal to this equation over here. So I'll copy this and then paste it here. This equation says that if we know the sqrt of price p, then we can get the TIC back. Here we're saying that we know what sqrt of price x96 is. So that means that we can calculate the sqrt of p. sqrt of p will be equal to dividing both sides of the equation by q96. So I'll bring q96 over here. And then we're dividing sqrt of price x96 by q96. And that will give us back the sqrt of p. And once we know what sqrt of p is, we can plug it in here. So I'll replace sqrt of p with sqrt of price x96 over q96. And that is how we get back the TIC. Take the log of base sqrt 1.0001 of the sqrt of price x96 over q96. And that will give us back the TIC. Let's go through an example. For the first example, we'll say that we know what the TIC is and we'll try to compute the sqrt of price x96. Let's say that TIC is equal to this number. This number I got from the Uniswap B3 USDC ETH pool contract. So to get the sqrt of price x96, the formula that we're going to be using is this. So I'll copy it, paste it here, and I'll move the sqrt of price x96 to the bottom. And let's compute this equation. We know that the TIC is equal to this number over here. Paste it. Times q96. Now q96, this is equal to 2 raised to the power of 96. And the other simplification that we'll make is that the sqrt of 1.0001 raised to this power is the same as dividing this number by 2. So what I mean here is, I'll copy this, paste it here. This is the same as dividing the TIC by 2. And whatever number we get, we take 1.0001 raised to that power. And this will be equal to the sqrt of price x96. To compute this number to get sqrt of price x96, we'll be using Python. Inside my Python Jupyter notebook, the first thing that I'll do is import the math library. Import math. Next I'll define what q96 is. Capital Q 96. This is equal to 2 to the 96. Next we'll write a function that given a TIC, it will calculate the sqrt price x96. So I'll say def TIC to sqrt price x96. This will take in a single input of the TIC. And then it will return the sqrt price x96. So to do that, we'll say return 1.0001 raised to the TIC divided by 2. And then we'll multiply this result by q96. And lastly, since Python returns decimals, we'll cast this into a number, an integer, by wrapping the whole expression in int. Here we're saying raise 1.0001 to the TIC divided by 2. Multiply the result by q96. And then ignore the decimal part and just give me back the number part, the integer part. Let's run through an example. We said that TIC is equal to this number. To get sqrt price x96, we'll call the function TIC to sqrt price x96, and then passing the TIC. And then I'll execute this script by hitting ctrl enter. And that is the sqrt price x96. I'll copy this. And back inside here, I'll replace sqrt price x96 with the number that we found. So I'll paste it. Okay, and that is, starting from TIC with this number, the sqrt price x96 will be this number in pink. Let's go over another example. Let's say that we know what the sqrt price x96 is. Let's say that we looked at the contract for Uniswap B3 USDC WEF pool contract, and we know what sqrt price x96 is. From that, how do we calculate the TIC? Let's go through an example. So this big number that I got, I got it from the Uniswap B3 USDC ETH pool contract. We'll say that sqrt price x96 is equal to this number. And what we're going to do here is, from this number, compute the TIC. To do that, I'll scroll up. And the equation that we're going to be using is this equation. Copy, scroll down, and then paste it here. We know what q96 is, q96 is 2 raised to the power of 96. And we'll replace sqrt price x96 with this number. And that will give us back the TIC. Copy this number, paste it here. Evaluate this equation, and this will give us back the TIC. So I'll put the TIC down here for now. Now notice that we're taking the log of base square root 1.0001. You won't be able to do this calculation on most calculators, so that is why we're using Python to calculate this expression. Back in my Jupyter notebook, let's write a function to calculate the TIC given the square root price x96. So I'll say def sqrt price x96 to TIC. And for the input, it's going to take sqrt price x96. And it will compute the TIC. First we'll compute the base of the log. The base is equal to math.square root of 1.0001. Next we'll calculate the square root price. Notice that the input is sqrt price x96. This means that this number is the square root of price multiplied by q96. So to get the square root price, we'll need to divide this by q96. P is equal to sqrt price x96 divided by q96. And lastly, we'll need to return the log. So we'll return math.log of the square root price, which is p. And the base of this log will be the base that we calculated in the first step. And the last step is that we'll return the integer part of this expression. So we'll use math.floor. Here we're using math.floor because math.floor will round down, whereas int will just ignore the decimal part. To show you this, example this, if we do int of minus 1.5, this will ignore the 0.5 part and return minus 1. Whereas if we use math.floor of minus 1.5, this will round down, this will round down minus 1.5 and we'll get back minus 2. So that is the difference. Int will ignore the decimal part, whereas math.floor will round down. So that is why we're using math.floor over here. Okay, so let's run through an example of this code. So I copied the square root price from the example. We'll say sqrt price x96 is equal to that big number that I just copied. And then we'll call the function sqrt price x96 to tic passing in sqrt price x96 and then execute the code. And we get that the tic is equal to 204632. Calculating the tic, we get back 204632. So those were examples of calculating from tic to sqrt price x96 and from sqrt price x96 to tic.